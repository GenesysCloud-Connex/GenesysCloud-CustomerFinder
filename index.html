<html>
  <head>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>
    <script>
      // Implicit grant credentials
      const clientId = "4eb23f0e-0a17-48dc-ac88-13a44cc82134";
      const redirectUri =
        "https://genesyscloud-connex.github.io/GenesysCloud_CustomerFinder/";

      // Set Genesys Cloud objects
      const platformClient = require("platformClient");
      const client = platformClient.ApiClient.instance;
      const externalContactsApi = new platformClient.ExternalContactsApi();
      let emailAdd = "";
      let firstName = "";

      client.setEnvironment("cac1.pure.cloud");
      client.setPersistSettings(true, "test_app");

      function submitBtn() {
        $("form").on("submit", function (e) {
          e.preventDefault();
          let dataString = $(this).serialize();
          emailAdd = document.getElementById("email").value;
          console.log(emailAdd);

          client.loginImplicitGrant(clientId, redirectUri).then(() => {
            console.log("Logged in");
            externalContactsApi
              .getExternalcontactsReversewhitepageslookup(
                emailAdd,
                {}
              )
              .then((data) => {
                firstName = data.contacts[0].firstName;
                console.log(firstName);
                return $('#greeting').html(`<h3>Hello, ${firstName}!</h3>`)
              });
          });
        });
        return;
      }
    </script>
  </head>
  <body>
    <div id="contact-form">
      <form action="" class="form">
        <label for="email">Email Address:</label><br />
        <input
          type="text"
          id="email"
          name="email"
          placeholder="sample@address.com"
        /><br />
        <!-- <button type="submit">Submit</button> -->
        <input
          type="submit"
          name="submit"
          value="Submit"
          onclick="submitBtn()"
          id="btn"
        />
      </form>
    </div>
    <div id="greeting"></div>
  </body>
</html>
