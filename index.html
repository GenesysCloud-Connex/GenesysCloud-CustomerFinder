<html>
  <head>
    <script type="text/javascript" charset="utf-8">
      (function (g, e, n, es, ys) {
        g['_genesysJs'] = e;
        g[e] = g[e] || function () {
          (g[e].q = g[e].q || []).push(arguments)
        };
        g[e].t = 1 * new Date();
        g[e].c = es;
        ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
      })(window, 'Genesys', 'https://apps.cac1.pure.cloud/genesys-bootstrap/genesys.min.js', {
        environment: 'cac1',
        deploymentId: '30c435f1-d288-4f86-935e-a93855014706'
      });
    </script>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>
    <script>
      // Implicit grant credentials
      const clientId = "4eb23f0e-0a17-48dc-ac88-13a44cc82134";
      const redirectUri =
        "https://genesyscloud-connex.github.io/GenesysCloud_CustomerFinder/";

      // Set Genesys Cloud objects
      const platformClient = require("platformClient");
      const client = platformClient.ApiClient.instance;
      const externalContactsApi = new platformClient.ExternalContactsApi();
      let emailAdd = "";
      let firstName = "";

      client.setEnvironment("cac1.pure.cloud");
      client.setPersistSettings(true, "test_app");

      function submitBtn() {
        $("form").on("submit", function (e) {
          e.preventDefault();
          let dataString = $(this).serialize();
          emailAdd = document.getElementById("email").value;
          console.log(emailAdd);

          client.loginImplicitGrant(clientId, redirectUri).then(() => {
            console.log("Logged in");
            externalContactsApi
              .getExternalcontactsReversewhitepageslookup(
                emailAdd,
                {}
              )
              .then((data) => {
                firstName = data.contacts[0].firstName;
                console.log(firstName);
                return $('#greeting').html(`<h3>Hello, ${firstName}!</h3>`)
              });
          });
        });
        return;
      }
    </script>
  </head>
  <body>
    <div id="contact-form">
      <form action="" class="form">
        <label for="email">Email Address:</label><br />
        <input
          type="text"
          id="email"
          name="email"
          placeholder="sample@address.com"
        /><br />
        <input
          type="submit"
          name="submit"
          value="Submit"
          onclick="submitBtn()"
          id="btn"
        />
      </form>
    </div>
    <div id="greeting"></div>
  </body>
</html>
